<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <title>1ëŒ€1 ì±„íŒ…</title>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        #navbar {
            display: flex;
            justify-content: flex-end;
            gap: 15px;
            padding: 10px;
            background: #f4f4f4;
            position: fixed;
            top: 0;
            right: 0;
            width: 60%;
        }
    </style>
</head>
<body>
    <!-- ðŸ”¥ ë„¤ë¹„ê²Œì´ì…˜ ë°” ì¶”ê°€ -->
    <div id="navbar">
        <button onclick="window.location.href='/chat.html'">Chat</button>
        <button onclick="window.location.href='/users.html'">Users</button>
        <button onclick="window.location.href='/'">Logout</button>
    </div>

    <h2 id="dm-title"></h2>
    <div id="messages"></div>
    <input id="message" type="text">
    <button id="send">ì „ì†¡</button>

    <script>
        const socket = io();
        const urlParams = new URLSearchParams(window.location.search);
        const toUser = urlParams.get("to"); // DM ìƒëŒ€ë°© ID
        const chatBox = document.getElementById("messages");
        const dmTitle = document.getElementById("dm-title");

        if (!toUser) {
            alert("ëŒ€ìƒì„ ì§€ì •í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤.");
            window.location.href = "/users"; // ìœ ì € ëª©ë¡ìœ¼ë¡œ ë¦¬ë””ë ‰ì…˜
            return;
        }

        dmTitle.textContent = `${toUser} ë‹˜ê³¼ì˜ 1:1 ì±„íŒ…`;

        socket.emit("join dm", toUser);

        socket.on("dm message", (data) => {
            const messageElement = document.createElement("div");
            messageElement.textContent = `${data.from}: ${data.message}`;
            chatBox.appendChild(messageElement);
        });

        document.getElementById("send").addEventListener("click", () => {
            const messageInput = document.getElementById("message");
            const message = messageInput.value;

            socket.emit("send dm", { to: toUser, message });
            messageInput.value = "";
        });
    </script>
</body>
</html>
